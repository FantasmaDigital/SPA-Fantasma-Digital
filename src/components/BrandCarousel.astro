---
import { brandCards } from "../constants/brands";

// Import styles
import "../styles/brands.css";
---

<section
  class="w-full bg-[#040406] text-white brand-section transition-colors duration-700"
>
  <div class="w-full mx-auto flex flex-row gap-6">
    <div class="flex flex-row sm:items-center gap-3 reveal-fade-up">
      <div class="flex pl-10 flex-col items-start gap-3">
        <div
          class="h-[2px] w-12 bg-white brand-line transition-colors duration-700"
        >
        </div>
        <span
          class="uppercase tracking-[0.25em] text-xs text-white/80 brand-text transition-colors duration-700"
          >Junto a los mejores</span
        >
      </div>
    </div>

    <div
      id="brandMarqueeContainer"
      class="relative w-full overflow-hidden rounded border border-white/10 bg-white/[0.03] backdrop-blur reveal-scale-up delay-200 brand-container transition-colors duration-700"
    >
      <div
        class="absolute inset-y-0 left-0 w-24 bg-gradient-to-r from-[#040406] via-[#040406]/70 to-transparent pointer-events-none brand-gradient-left transition-colors duration-700"
      >
      </div>
      <div
        class="absolute inset-y-0 right-0 w-24 bg-gradient-to-l from-[#040406] via-[#040406]/70 to-transparent pointer-events-none brand-gradient-right transition-colors duration-700"
      >
      </div>

      <div
        id="brandMarquee"
        class="flex gap-4 py-5 pl-6 animate-marquee"
        aria-hidden="true"
      >
        {
          brandCards.concat(brandCards).map((brand, index) => (
            <div class="brand-card flex-shrink-0 hover:cursor-pointer flex items-center gap-3 min-w-[220px] px-5 py-3 rounded-xl border border-white/10 bg-white/5 shadow-[0_15px_45px_rgba(0,0,0,0.35)] backdrop-blur-md transition-colors duration-700">
              <div
                class="brand-icon w-12 h-12 rounded-2xl flex items-center justify-center border border-white/15 shadow-[0_10px_30px_rgba(0,0,0,0.35)]"
                style="background: linear-gradient(135deg, #2a2a2a, #0f0f0f); box-shadow: 0 12px 32px rgba(0,0,0,0.35);"
              >
                <span class="block" set:html={brand.icon} />
              </div>
              <div class="flex flex-col">
                <span class="text-white font-semibold leading-tight brand-card-title transition-colors duration-700">
                  {brand.name}
                </span>
                <span class="text-xs uppercase tracking-[0.2em] text-white/60 brand-card-tagline transition-colors duration-700">
                  {brand.tagline}
                </span>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</section>

<style>
  /* Theme Light Overrides for Brand Carousel */
  :global(body.theme-light) .brand-section {
    background-color: #ffffff !important;
    color: #040406 !important;
  }

  :global(body.theme-light) .brand-line {
    background-color: #040406 !important;
  }

  :global(body.theme-light) .brand-text {
    color: rgba(4, 4, 6, 0.6) !important;
  }

  :global(body.theme-light) .brand-container {
    border-color: rgba(4, 4, 6, 0.1) !important;
    background-color: rgba(4, 4, 6, 0.03) !important;
  }

  :global(body.theme-light) .brand-gradient-left {
    background: linear-gradient(
      to right,
      #ffffff,
      rgba(255, 255, 255, 0.7),
      transparent
    ) !important;
  }

  :global(body.theme-light) .brand-gradient-right {
    background: linear-gradient(
      to left,
      #ffffff,
      rgba(255, 255, 255, 0.7),
      transparent
    ) !important;
  }

  :global(body.theme-light) .brand-card {
    border-color: rgba(4, 4, 6, 0.1) !important;
    background-color: rgba(4, 4, 6, 0.05) !important;
  }

  :global(body.theme-light) .brand-card-title {
    color: #040406 !important;
  }

  :global(body.theme-light) .brand-card-tagline {
    color: rgba(4, 4, 6, 0.5) !important;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const marquee = document.getElementById("brandMarquee");
    const cards = Array.from(
      document.querySelectorAll<HTMLElement>(".brand-card")
    );

    // --- MARQUEE INTERACTION: hover to "freeze time" ---
    if (marquee && cards.length) {
      const clearFocus = () => {
        marquee.classList.remove("marquee-paused");
        cards.forEach((card) => {
          card.classList.remove("is-focused", "is-dimmed");
        });
      };

      cards.forEach((card) => {
        card.addEventListener("mouseenter", () => {
          marquee.classList.add("marquee-paused");
          cards.forEach((item) => {
            if (item === card) {
              item.classList.add("is-focused");
              item.classList.remove("is-dimmed");
            } else {
              item.classList.add("is-dimmed");
              item.classList.remove("is-focused");
            }
          });
        });

        card.addEventListener("mouseleave", clearFocus);
      });
    }

    // --- LATERAL PULL: near left bar we simulate a suction ---
    if (marquee && cards.length) {
      const PULL_THRESHOLD = 85; // px from the left edge

      const tick = () => {
        const marqueeRect = marquee.getBoundingClientRect();

        cards.forEach((card) => {
          const rect = card.getBoundingClientRect();
          const distanceToLeft = rect.right - marqueeRect.left;

          if (distanceToLeft < PULL_THRESHOLD) {
            card.classList.add("is-pulled");
          } else {
            card.classList.remove("is-pulled");
          }
        });

        requestAnimationFrame(tick);
      };

      requestAnimationFrame(tick);
    }
  });
</script>
