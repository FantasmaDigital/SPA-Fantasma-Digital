---
import "../styles/hero.css";
---

<div
  id="hero"
  class="relative w-full h-screen overflow-hidden flex flex-col items-center justify-center bg-[#040406] hero-section transition-colors duration-700"
>
  <div
    class="absolute inset-0 z-0 opacity-70 [background-size:40px_40px] [background-image:linear-gradient(to_right,#1f1f1f_1px,transparent_1px),linear-gradient(to_bottom,#1f1f1f_1px,transparent_1px)] hero-grid transition-opacity duration-700"
    data-parallax
    data-speed="0.05"
  >
  </div>
  <div
    id="heroInteractiveGrid"
    class="absolute inset-0 z-[5] opacity-70"
    aria-hidden="true"
    data-parallax
    data-speed="0.08"
  >
  </div>
  <div
    class="pointer-events-none absolute inset-x-0 bottom-0 top-1/2 z-10 bg-gradient-to-t from-[#040406] via-[#040406]/80 to-transparent hero-gradient-bottom transition-colors duration-700"
  >
  </div>
  <div
    class="pointer-events-none absolute inset-0 z-20 bg-[#040406]/60 [mask-image:radial-gradient(circle_at_center,transparent_0%,black_100%)] hero-vignette transition-colors duration-700"
  >
  </div>

  <!-- Ambient Glows -->
  <div
    class="absolute top-[-20%] left-[-10%] w-[50vw] h-[50vw] bg-[#25c4ff]/10 rounded-full blur-[120px] pointer-events-none mix-blend-screen animate-pulse-slow"
  >
  </div>
  <div
    class="absolute bottom-[-20%] right-[-10%] w-[50vw] h-[50vw] bg-[#ffcc33]/5 rounded-full blur-[120px] pointer-events-none mix-blend-screen animate-pulse-slow delay-1000"
  >
  </div>

  <!-- Decorative Code Snippets (Live Typing) -->
  <div
    class="absolute top-[18%] left-[5%] hidden lg:block pointer-events-none opacity-40 font-mono text-[10px] leading-relaxed text-[#25c4ff]"
  >
    <div
      class="typing-code"
      data-code={`const system = {
  status: "OPTIMIZED",
  latam_node: true,
  security: "MAX"
};`}
    >
    </div>
  </div>

  <div
    class="absolute bottom-[25%] right-[5%] hidden lg:block pointer-events-none opacity-40 font-mono text-[10px] leading-relaxed text-[#ffcc33] text-right"
  >
    <div
      class="typing-code"
      data-code={`await Fantasma.init({
  mode: "SCALABLE",
  modules: ["AI", "UX"]
});`}
    >
    </div>
  </div>

  <div
    class="absolute top-[25%] right-[10%] hidden lg:block pointer-events-none opacity-30 font-mono text-[10px] leading-relaxed text-white/50"
  >
    <div
      class="typing-code"
      data-code={`import { Future } 
  from "@fantasma/core";`}
    >
    </div>
  </div>
  <div
    class="relative z-30 w-[90%] flex flex-col justify-between items-center gap-10"
  >
    <div class="w-full md:w-[55%] flex flex-col items-center text-center gap-5">
      <h1
        class="text-[6vw] font-bold text-center flex justify-center reveal-fade-up hero-title transition-colors duration-700 leading-tight"
      >
        <span
          id="heroTitle"
          class="bg-clip-text text-transparent bg-gradient-to-b from-white via-white to-white/50 drop-shadow-sm"
          >Innovación Escalable.</span
        >
      </h1>
      <p
        class="text-white text-[2vw] reveal-fade-up delay-200 hero-description transition-colors duration-700"
      >
        Transformamos negocios en El Salvador y Centroamérica con software de
        alto rendimiento, diseño centrado en el usuario y estrategias digitales
        impulsadas por IA.
      </p>

      <a
        href="#contact"
        class="relative inline-flex h-12 overflow-hidden rounded-full p-[1px] focus:outline-none mt-8 reveal-fade-up delay-400 hero-cta group"
      >
        <span
          class="absolute inset-[-1000%] animate-[spin_2s_linear_infinite] bg-[conic-gradient(from_90deg_at_50%_50%,#25c4ff_0%,#040406_50%,#ffcc33_100%)]"
        ></span>
        <span
          class="inline-flex h-full w-full cursor-pointer items-center justify-center rounded-full bg-[#040406] px-10 py-1 text-xs font-bold uppercase tracking-widest text-white backdrop-blur-3xl transition-colors duration-300 group-hover:bg-[#040406]/80 hero-cta-inner gap-3"
        >
          Iniciar Proyecto
          <i
            class="fa-solid fa-arrow-right transform -rotate-45 group-hover:rotate-0 transition-transform duration-300 text-[#ffcc33]"
          ></i>
        </span>
      </a>
    </div>
  </div>
</div>

<style>
  /* Theme Light Overrides for Hero */
  :global(body.theme-light) .hero-section {
    background-color: #ffffff !important;
  }

  :global(body.theme-light) .hero-grid {
    background-image:
      linear-gradient(to right, #e5e5e5 1px, transparent 1px),
      linear-gradient(to bottom, #e5e5e5 1px, transparent 1px) !important;
  }

  :global(body.theme-light) .hero-gradient-bottom {
    background: linear-gradient(
      to top,
      #ffffff,
      rgba(255, 255, 255, 0.8),
      transparent
    ) !important;
  }

  :global(body.theme-light) .hero-vignette {
    background-color: rgba(255, 255, 255, 0.6) !important;
    mask-image: radial-gradient(
      circle at center,
      transparent 10%,
      black 85%
    ) !important;
  }

  :global(body.theme-light) .hero-title {
    color: #040406 !important;
  }

  :global(body.theme-light) .hero-description {
    color: #333333 !important;
  }

  :global(body.theme-light) .hero-cta {
    border: none !important;
    background: transparent !important;
  }

  :global(body.theme-light) .hero-cta-inner {
    background-color: #ffffff !important;
    color: #040406 !important;
  }

  :global(body.theme-light) .hero-cta-inner:hover {
    background-color: #f0f0f0 !important;
  }
  :global(body.theme-light) .hero-cta-text {
    color: #040406 !important;
  }
  :global(body.theme-light) .hero-cta:hover {
    background-color: rgba(4, 4, 6, 0.1) !important;
  }

  @keyframes pulse-slow {
    0%,
    100% {
      opacity: 0.5;
      transform: scale(1);
    }
    50% {
      opacity: 0.8;
      transform: scale(1.1);
    }
  }
  .typing-cursor::after {
    content: "|";
    animation: blink 1s step-end infinite;
    margin-left: 2px;
    opacity: 0.7;
  }
  @keyframes blink {
    50% {
      opacity: 0;
    }
  }
  .typing-code {
    white-space: pre;
  }
</style>

<script>
  // Forzar inicio en el top al recargar la página (para el Preloader)
  if (history.scrollRestoration) {
    history.scrollRestoration = "manual";
  }
  window.scrollTo(0, 0);

  document.addEventListener("DOMContentLoaded", () => {

    const titleElement = document.getElementById("heroTitle");
    if (!(titleElement instanceof HTMLElement)) return;

    const originalText = "Innovación Escalable.";
    titleElement.textContent = ""; // Vaciamos para iniciar la animación

    const SCROLL_THRESHOLD = 50;

    const SLOW_TYPE_SPEED_MS = 150;
    const FAST_TYPE_SPEED_MS = 50;

    let isRevealed = false;
    let isAnimating = false;
    let animationTimeout: any = null;
    let initialAnimationDone = false;

    function stopAnimation() {
      if (animationTimeout !== null) clearTimeout(animationTimeout);
      isAnimating = false;
    }

    // Función principal de animación de tipeo/borrado
    function animateTyping(targetText: any, speed: any) {
      if (!titleElement) return;
      stopAnimation();
      isAnimating = true;

      const textLength = originalText.length;
      let currentText = titleElement.textContent || "";
      let isTyping = targetText === originalText;

      const typeAnimation = () => {
        let currentLength = currentText.length;

        if (isTyping) {
          if (currentLength < textLength) {
            currentText += originalText[currentLength];
            titleElement.textContent = currentText;
            animationTimeout = setTimeout(typeAnimation, speed);
          } else {
            isAnimating = false;
            isRevealed = true;
            if (!initialAnimationDone) {
              initialAnimationDone = true;
            }
          }
        } else {
          if (currentLength > 0) {
            currentText = currentText.substring(0, currentLength - 1);
            titleElement.textContent = currentText;
            animationTimeout = setTimeout(typeAnimation, speed);
          } else {
            isAnimating = false;
            isRevealed = false;
          }
        }
      };

      typeAnimation();
    }

    // Lógica de Scroll para controlar la animación
    function handleScroll() {
      const scroll = window.scrollY;

      // 1. CONDICIÓN DE BORRADO (Scroll Down)
      if (scroll > SCROLL_THRESHOLD && isRevealed && initialAnimationDone) {
        animateTyping("", FAST_TYPE_SPEED_MS);
      }

      // 2. CONDICIÓN DE ESCRITURA (Scroll Up/Top)
      else if (scroll <= SCROLL_THRESHOLD && initialAnimationDone) {
        if (!isRevealed) {
          animateTyping(originalText, SLOW_TYPE_SPEED_MS);
        }
      }
    }

    // --- INICIO DE LA PÁGINA ---

    // 1. Inicia la animación de ESCRITURA al cargar la página (Única vez).
    animateTyping(originalText, SLOW_TYPE_SPEED_MS);

    // 2. Añade el listener de scroll.
    window.addEventListener("scroll", handleScroll);

    // --- LOGICA PARA SNIPPETS DE CODIGO (Efecto Matrix/Typing) ---
    const codeSnippets = document.querySelectorAll(".typing-code");

    codeSnippets.forEach((el, index) => {
      const text = el.getAttribute("data-code") || "";
      const delay = index * 1500 + 500; // Stagger start times

      setTimeout(() => {
        let i = 0;
        el.innerHTML = '<span class="typing-cursor"></span>';
        const cursor: any = el.querySelector(".typing-cursor");

        function typeChar() {
          if (i < text.length) {
            const char = text.charAt(i);
            // Insert char before cursor
            cursor.insertAdjacentText("beforebegin", char);
            i++;
            setTimeout(typeChar, Math.random() * 50 + 30); // Random typing speed
          }
        }
        typeChar();
      }, delay);
    });
  });
</script>
