---
import Logo from "../components/Logo.astro";
import { headerLinks } from "../constants/header";

const socialMedia = [
  {
    name: "Facebook",
    url: "https://www.facebook.com/",
    icon: "fa-facebook-f",
  },
  {
    name: "Instagram",
    url: "https://www.instagram.com/",
    icon: "fa-instagram",
  },
  {
    name: "Tiktok",
    url: "https://www.tiktok.com/",
    icon: "fa-tiktok",
  },
];
---

<header class="w-full fixed z-[120]">
  <div
    class="p-[1.5vw] w-[90%] mx-auto flex flex-row justify-between text-white"
  >
    <div id="logo-white" class="relative z-[140]">
      <Logo variant="white" />
    </div>
    <div id="logo-black" class="relative z-[140] hidden">
      <Logo variant="black" />
    </div>

    <ul class="flex flex-row gap-20 uppercase">
      <li
        class="inline-block mr-4 text-md font-semibold navbar-li link-underline li-spacing"
      >
        <a href="/">Inicio</a>
      </li>
      <li
        class="inline-block mr-4 text-md font-semibold navbar-li link-underline li-spacing"
      >
        <a href="/about">Acerca de</a>
      </li>
      <li
        class="inline-block mr-4 text-md font-semibold navbar-li link-underline li-spacing"
      >
        <a href="/services">Servicios</a>
      </li>
      <li
        class="inline-block mr-4 text-md font-semibold navbar-li link-underline li-spacing"
      >
        <a href="/contact">Contacto</a>
      </li>
      <li
        class="inline-block showMenuBtn menu-toggle hover:cursor-pointer mr-4 text-3xl font-semibold justify-center items-center my-auto relative"
        style="z-index:100;"
      >
        <div
          id="showMenu"
          class="m-auto flex justify-center items-center relative z-[150]"
        >
          <img
            id="plusMenu"
            src="svg/plus-svgrepo-com-wh.svg"
            class="w-6 h-6 relative z-[155]"
          />
        </div>
      </li>
    </ul>
  </div>

  <div id="layerWhite" class="layer-white hidden flex flex-row">
    <div class="triangle-top flex flex-col">
      <ul
        class="flex flex-col w-full font-bold text-[6vw] z-20 m-auto justify-end items-start h-full pb-16"
      >
        {
          headerLinks.slice(0,4).map((h) => (
            <li class="showMenu-link link-underline">
              <a href={h.href} class="text-[109px]" style="line-height: 128px;">
                {h.title}
              </a>
            </li>
          ))
        }
      </ul>
    </div>

    <div class="triangle-bottom flex flex-col">
      <div
        class="flex flex-col h-[80%] m-auto w-full font-bold justify-start pb-[5vh] absolute bottom-0 left-0 pl-[1.5vw]"
      >
        <div
          class="grid grid-cols-1 lg:grid-cols-[1.6fr_1fr] gap-10 items-start w-full pr-[2vw]"
        >
          <div class="flex flex-col gap-6">
            <div class="flex flex-col mb-2">
              <h2 class="text-[2vw] bg-[#040406] p-2 text-white w-max rounded">
                Nuestras redes sociales
              </h2>
            </div>
            <ul class="flex flex-row gap-8 uppercase">
              {
                socialMedia.map((s) => (
                  <li class="uppercase">
                    <a
                      href={s.url}
                      target="_blank"
                      rel="noreferrer"
                      class="flex flex-row items-center gap-3 group"
                    >
                      <i
                        class={`fa-brands ${s.icon} text-[1.5vw] group-hover:text-[#ffcc33] transition-all duration-300 hover:shadow-2xl`}
                      />
                      <span class="social-link link-underline">{s.name}</span>
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>

        <span class="w-[80%] h-1 rounded-full bg-[#ffcc33] my-8"></span>

        <div class="quick-links flex flex-col gap-4">
          <h2 class="text-[2vw] bg-[#040406] p-2 text-white w-max rounded mb-2">
            Enlaces rápidos
          </h2>
          <ul class="flex flex-col gap-2 text-[1.4vw] font-semibold text-black">
            {
              headerLinks.map((l) => {
                return (
                  <li class="flex flex-row items-center">
                    <span class="text-[#040406] font-bold pr-2">-</span>
                    <a
                      href={l.href}
                      class="link-underline transition-all duration-300 flex flex-row gap-4"
                    >
                      {l.title}
                    </a>
                  </li>
                );
              })
            }
          </ul>
        </div>
        <p class="font-semibold text-md absolute bottom-[2vw] right-[2vw]">
          Created and Designed by Fantasma Digital
        </p>
      </div>
    </div>
  </div>
</header>

<style>
  /* Animaciones generales */
  @keyframes leftAnimation {
    0% {
      transform: translateY(-100%);
    }
    100% {
      transform: translateY(0);
    }
  }

  @keyframes rightAnimation {
    0% {
      transform: translateY(100%);
    }
    100% {
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }

  .showMenu-link {
    animation: fadeIn 2.5s ease-in-out forwards;
    margin-left: 10vw;
  }

  .applyLeftAnimation {
    animation: leftAnimation 0.5s forwards;
  }

  .applyRightAnimation {
    animation: rightAnimation 0.5s forwards;
  }

  .showMenuBtn {
    transition: transform 0.3s ease;
    z-index: 15;
    color: white;
  }
  /* Espacio entre letras del li */
  .li-spacing {
    letter-spacing: 0.1em;
    margin: auto;
  }

  .navbar-li {
    opacity: 1;
    transition: opacity 0.3s ease;
  }

  .link-underline {
    position: relative;
    display: inline-block;
    padding-bottom: 3px;
  }

  .link-underline::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 0%;
    height: 3px;
    border-radius: 999px;
    background-color: #ffcc33;
    transition: width 0.7s ease;
  }

  .link-underline:hover::after {
    width: 100%;
  }

  /* Thicker, tighter underline inside the full-screen menu */
  .layer-white .link-underline {
    padding-bottom: 0px;
  }

  .layer-white .link-underline::after {
    height: 6px;
  }

  /* Subrayado mA!s delgado solo para redes sociales */
  .social-link.link-underline {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding-bottom: 2px;
  }

  .social-link.link-underline::after {
    height: 1.5px;
  }

  /* En la capa blanca, adelgazamos aun mA!s el subrayado de redes */
  .layer-white .social-link.link-underline {
    padding-bottom: 1px;
  }

  .layer-white .social-link.link-underline::after {
    height: 1.5px;
  }

  .layer-white .social-panel {
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.92),
      rgba(255, 255, 255, 0.82)
    );
    border-radius: 14px;
    border: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0 18px 60px rgba(0, 0, 0, 0.08);
    padding: 16px 18px;
  }

  .layer-white .social-panel p {
    max-width: 420px;
  }

  .layer-white .quick-links .link-underline {
    padding-bottom: 3px;
  }

  .layer-white .quick-links .link-underline::after {
    height: 2px;
  }

  /* Ocultar */
  .hidden-li {
    opacity: 0;
  }

  /* Delay individual para cada item */
  .navbar-li:nth-child(1) {
    transition-delay: 0s;
  }
  .navbar-li:nth-child(2) {
    transition-delay: 0.2s;
  }
  .navbar-li:nth-child(3) {
    transition-delay: 0.3s;
  }
  .navbar-li:nth-child(4) {
    transition-delay: 0.4s;
  }
  .navbar-li:nth-child(5) {
    transition-delay: 0.5s;
  }

  .layer-white {
    height: 100dvh;
    width: 100%;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 90;
  }

  /* IN animations (Vertical Invertida) */
  /* ENTRADA DEL PANEL IZQUIERDO (triangle-top): Viene de ARRIBA hacia abajo */
  @keyframes leftIn {
    0% {
      transform: translateY(-100%);
    }
    100% {
      transform: translateY(0);
    }
  }
  /* ENTRADA DEL PANEL DERECHO (triangle-bottom): Viene de ABAJO hacia arriba */
  @keyframes rightIn {
    0% {
      transform: translateY(100%);
    }
    100% {
      transform: translateY(0);
    }
  }

  /* OUT animations (Vertical Invertida al revés) */
  /* SALIDA DEL PANEL IZQUIERDO (triangle-top): Se va ABAJO */
  @keyframes leftOut {
    0% {
      transform: translateY(0);
    }
    100% {
      transform: translateY(100%);
    }
  }
  /* SALIDA DEL PANEL DERECHO (triangle-bottom): Se va ARRIBA */
  @keyframes rightOut {
    0% {
      transform: translateY(0);
    }
    100% {
      transform: translateY(-100%);
    }
  }

  /* Clases para aplicar IN */
  .triangle-top.in {
    animation: leftIn 0.7s cubic-bezier(0.33, 1, 0.68, 1) forwards;
  }
  .triangle-bottom.in {
    animation: rightIn 0.7s cubic-bezier(0.33, 1, 0.68, 1) forwards;
  }

  .triangle-top.out {
    animation: leftOut 0.6s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
  }
  .triangle-bottom.out {
    animation: rightOut 0.6s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
  }

  .triangle-top,
  .triangle-bottom {
    background-color: white;
    height: 100dvh;
    width: 50vw;
    z-index: 6;
    position: relative;
    will-change: transform;
    transform-style: preserve-3d;
  }

  .changeColor {
    color: #040406;
  }

  .menu-toggle {
    mix-blend-mode: difference;
  }

  .menu-toggle img {
    transition:
      filter 0.3s ease,
      opacity 0.3s ease;
    filter: invert(0);
  }

  .menu-toggle.open img {
    filter: invert(1);
    opacity: 1;
  }

  .plusAnimationIn {
    width: 3.5vw;
    height: 3.5vw;
    margin: auto;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .plusAnimationOut {
    width: 3.5vw;
    height: 3.5vw;
    margin: auto;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .rotate45 {
    transition: transform 0.5s ease;
    transform: rotate(45deg);
  }
</style>

<script>
  const items = document.querySelectorAll(".navbar-li");
  const showMenu = document.querySelector("#showMenu");
  const showMenuBtn = document.querySelector(".showMenuBtn");
  const layerWhite = document.querySelector("#layerWhite");
  const plusMenu = document.querySelector("#plusMenu");

  // Variables de Logos Corregidas (según la estructura de ID del HTML arriba)
  const logoBlack = document.querySelector("#logo-black");
  const logoWhite = document.querySelector("#logo-white");

  function updateHiddenItems() {
    const scroll = window.scrollY;
    const hideCount = Math.floor(scroll / 10);

    items.forEach((el, index) => {
      if (index < hideCount) {
        el.classList.add("hidden-li");
      } else {
        el.classList.remove("hidden-li");
      }
    });
    if (hideCount > 0) {
      showMenuBtn?.classList.add("plusAnimationIn");
      showMenuBtn?.classList.remove("plusAnimationOut");
    } else {
      showMenuBtn?.classList.remove("plusAnimationIn");
      showMenuBtn?.classList.add("plusAnimationOut");
    }
  }

  function detectarPosicionComponente(selector: any) {
    const elemento = document.querySelector(selector);
    if (!elemento) return;
  }

  // Evento scroll
  document.addEventListener("scroll", updateHiddenItems);

  // Detecta al recargar la página
  window.addEventListener("load", () => {
    updateHiddenItems();
    detectarPosicionComponente(".navbar");
  });

  showMenu?.addEventListener("click", () => {
    if (!layerWhite) return;
    const isOpen = !layerWhite.classList.contains("hidden");

    items.forEach((el) => el.classList.toggle("hidden-li"));

    // El icono del menú cambia de color y figura
    if (plusMenu instanceof HTMLImageElement) {
      plusMenu.src = isOpen
        ? "svg/plus-svgrepo-com-wh.svg"
        : "svg/plus-svgrepo-com.svg";
    }

    showMenuBtn?.classList.toggle("rotate45");
    showMenuBtn?.classList.toggle("changeColor");
    showMenuBtn?.classList.toggle("open");

    const top = document.querySelector(".triangle-top");
    const bottom = document.querySelector(".triangle-bottom");

    if (!top || !bottom) {
      // Manejo de visibilidad simple si no hay elementos de transición
      if (!isOpen) {
        layerWhite.classList.remove("hidden");
        logoWhite?.classList.add("hidden");
        logoBlack?.classList.remove("hidden");
      } else {
        logoWhite?.classList.remove("hidden");
        logoBlack?.classList.add("hidden");
        setTimeout(() => {
          layerWhite.classList.add("hidden");
        }, 500);
      }
      return;
    }

    if (!isOpen) {
      // === OPEN MENU (Fondo blanco) ===
      layerWhite.classList.remove("hidden");

      top.classList.remove("out");
      bottom.classList.remove("out");

      // OCULTAR logo BLANCO, MOSTRAR logo NEGRO
      logoWhite?.classList.add("hidden");
      logoBlack?.classList.remove("hidden");

      // Aplica animación de entrada (vertical invertida)
      top.classList.add("in");
      bottom.classList.add("in");
    } else {
      // === CLOSE MENU (Fondo oscuro) ===
      top.classList.remove("in");
      bottom.classList.remove("in");

      // Aplica animación de salida (vertical invertida, saliendo)
      top.classList.add("out");
      bottom.classList.add("out");

      // MOSTRAR logo BLANCO, OCULTAR logo NEGRO
      logoWhite?.classList.remove("hidden");
      logoBlack?.classList.add("hidden");

      // Esperar fin de animación para ocultar
      setTimeout(() => {
        layerWhite.classList.add("hidden");
      }, 600); // Debe coincidir con la duración de la animación de salida (0.6s)
    }
  });
</script>
