---
import "../../styles/brands.css";

const techs = [
  // First Row (Right Direction)
  [
    { name: "ReactJS", slug: "react", color: "61DAFB", tagline: "Librería UI" },
    { name: "Next.js", slug: "nextdotjs", color: "FFFFFF", tagline: "Framework" },
    { name: "Astro", slug: "astro", color: "FF5C01", tagline: "Sitio Estático" },
    { name: "Angular", slug: "angular", color: "DD0031", tagline: "Plataforma" },
    { name: "JavaScript", slug: "javascript", color: "F7DF1E", tagline: "Lenguaje" },
    { name: "Node.js", slug: "nodedotjs", color: "339933", tagline: "Runtime" },
    { name: "NestJS", slug: "nestjs", color: "E0234E", tagline: "Framework" },
  ],
  // Second Row (Left Direction)
  [
    { name: "C#", slug: "csharp", color: "512BD4", tagline: "Lenguaje" },
    { name: "Java", slug: "java", color: "007396", tagline: "Lenguaje", imgSrc: "https://api.iconify.design/logos:java.svg" },
    { name: "Go", slug: "go", color: "00ADD8", tagline: "Concurrencia" },
    { name: "PHP", slug: "php", color: "777BB4", tagline: "Scripting" },
    { name: "Spring Boot", slug: "springboot", color: "6DB33F", tagline: "Framework" },
    { name: "Express", slug: "express", color: "FFFFFF", tagline: "Web Fwk" },
    { name: "Docker", slug: "docker", color: "2496ED", tagline: "Contenedores" },
    { name: "Kubernetes", slug: "kubernetes", color: "326CE5", tagline: "Orquestación" },
  ],
  // Third Row (Right Direction)
  [
    { name: "AWS", slug: "amazonaws", color: "FF9900", tagline: "Nube" },
    { name: "Google Cloud", slug: "googlecloud", color: "4285F4", tagline: "Nube" },
    { name: "Vercel", slug: "vercel", color: "FFFFFF", tagline: "Despliegue" },
    { name: "Kotlin", slug: "kotlin", color: "7F52FF", tagline: "Lenguaje" },
    { name: "C++", slug: "cplusplus", color: "00599C", tagline: "Lenguaje" },
    { name: "React Native", slug: "react", color: "61DAFB", tagline: "Móvil" },
    { name: "n8n", slug: "n8n", color: "FF6D5A", tagline: "Automatización" },
    { name: "Google", slug: "google", color: "4285F4", tagline: "Búsqueda" },
  ]
];
---

<section id="tech-stack" class="w-full bg-[#040406] py-24 relative brand-section">
  <div class="w-full relative z-10">
    <div class="mb-16 px-6 xl:px-12 text-center reveal-fade-up">
      <h2 class="text-xs font-bold tracking-[0.3em] uppercase text-[#ffcc33] mb-3">
        Ecosistema Técnico
      </h2>
      <h3 class="text-5xl xl:text-6xl font-bold text-white tracking-tight">
        HERRAMIENTAS QUE <span class="text-[#25c4ff]">IMPULSAN</span>
      </h3>
    </div>

    <div class="flex flex-col">
      {techs.map((row, rowIndex) => (
        <div class="relative w-full overflow-hidden brand-container">
           <!-- Gradients -->
           <div class="absolute inset-y-0 left-0 w-12 bg-gradient-to-r from-[#040406] via-[#040406]/80 to-transparent z-10 pointer-events-none brand-gradient-left"></div>
           <div class="absolute inset-y-0 right-0 w-12 bg-gradient-to-l from-[#040406] via-[#040406]/80 to-transparent z-10 pointer-events-none brand-gradient-right"></div>

          <div 
            class:list={[
              "flex gap-6 w-max py-6 px-4 marquee-content overflow-x-hidden",
              rowIndex % 2 === 0 ? "animate-marquee-right" : "animate-marquee-left"
            ]}
          >
            {[...row, ...row, ...row, ...row].map((tech) => (
              <div 
                class="brand-card flex-shrink-0 hover:cursor-pointer flex items-center gap-4 min-w-[200px] px-5 py-3 rounded-2xl border border-white/5 bg-white/[0.03] shadow-lg backdrop-blur-md transition-all duration-500 group"
                style={`--brand-color: #${tech.color};`}
              >
                 <div
                  class="brand-icon w-10 h-10 rounded-lg flex items-center justify-center border border-white/10 shadow-inner transition-transform duration-500 group-hover:scale-110"
                  style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));"
                >
                  <div class="w-5 h-5 flex items-center justify-center transition-all duration-500 text-white/70 group-hover:text-white">
                    <img
                      src={(tech as any).imgSrc || `https://cdn.simpleicons.org/${tech.slug}/${tech.color}`}
                      onerror={!(tech as any).imgSrc ? `this.onerror=null; this.src='https://api.iconify.design/simple-icons:${tech.slug}.svg?color=%23${tech.color}';` : null}
                      alt={tech.name}
                      class="w-full h-full object-contain opacity-80 group-hover:opacity-100 transition-opacity"
                      loading="lazy"
                    />
                  </div>
                </div>

                <div class="flex flex-col">
                  <span class="text-white font-bold text-sm tracking-tight transition-colors duration-300 brand-card-title">
                    {tech.name}
                  </span>
                  <span class="text-[9px] font-bold uppercase tracking-wider text-white/40 transition-colors duration-300 brand-card-tagline">
                    {tech.tagline}
                  </span>
                </div>

                <!-- Glow -->
                <div class="absolute inset-0 rounded-2xl bg-[var(--brand-color)] opacity-0 group-hover:opacity-[0.04] blur-xl transition-opacity duration-500 pointer-events-none"></div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  </div>

  {/* Background accents */}
  <div
    class="absolute top-0 left-0 w-full h-full pointer-events-none select-none"
  >
    <div
      class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-[#040406] to-transparent z-20"
    >
    </div>
    <div
      class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-[#040406] to-transparent z-20"
    >
    </div>
  </div>

  <!-- Spotlight Overlay -->
  <div 
    id="spotlight-overlay" 
    class="absolute inset-0 z-50 flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300"
  >
    <div 
      role="dialog"
      class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity duration-300 z-10"
    ></div>
    
    <div 
      id="spotlight-card"
      class="relative flex flex-col items-center gap-6 min-w-[320px] px-8 py-8 rounded-3xl border border-white/20 bg-[#09090b] shadow-2xl transform scale-95 transition-all duration-200 translate-y-4 will-change-transform z-20"
      style="--brand-color: #ffffff;"
    >
      <!-- Glow -->
      <div class="absolute inset-0 rounded-3xl bg-[var(--brand-color)] opacity-20 blur-3xl pointer-events-none"></div>

      <div
        class="w-24 h-24 rounded-2xl flex items-center justify-center border border-white/10 shadow-inner bg-[#18181b]"
      >
        <img
          id="spotlight-img"
          src=""
          alt=""
          class="w-14 h-14 object-contain filter drop-shadow-xl opacity-100"
          loading="eager"
        />
      </div>

      <div class="flex flex-col items-center text-center">
        <span id="spotlight-name" class="text-white font-bold text-3xl tracking-tight mb-2">
          
        </span>
        <span id="spotlight-tagline" class="text-xs font-bold uppercase tracking-widest text-white/50">
          
        </span>
      </div>
    </div>
  </div>
</section>

<style>
  #tech-stack {
    border-top: 1px solid rgba(255, 255, 255, 0.03);
  }

  /* Override animation duration for marquees */
  .animate-marquee-left {
    animation: marquee 60s linear infinite;
  }

  .animate-marquee-right {
    animation: marquee-reverse 60s linear infinite;
  }

  @keyframes marquee {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
  }

  @keyframes marquee-reverse {
    from { transform: translateX(-50%); }
    to { transform: translateX(0); }
  }
  
  .marquee-paused {
    animation-play-state: paused;
  }
  
  /* Spotlight Active States */
  .spotlight-active #spotlight-overlay {
    opacity: 1;
    pointer-events: auto; /* Enable clicks for background close */
  }
  
  .spotlight-active #spotlight-card {
    transform: scale(1) translateY(0);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const section = document.getElementById("tech-stack");
    const overlay = document.getElementById("spotlight-overlay");
    const spotlightCard = document.getElementById("spotlight-card");
    const spotlightImg = document.getElementById("spotlight-img") as HTMLImageElement;
    const spotlightName = document.getElementById("spotlight-name");
    const spotlightTagline = document.getElementById("spotlight-tagline");

    const marquees = document.querySelectorAll(".marquee-content");
    const cards = document.querySelectorAll(".brand-card");

    // Close Spotlight Function
    const closeSpotlight = () => {
      if (section) {
        section.classList.remove("spotlight-active");
        marquees.forEach(m => m.classList.remove("marquee-paused"));
        cards.forEach(c => c.classList.remove("is-focused", "is-dimmed"));
      }
    };

    // Close on overlay click (Background only)
    if (overlay) {
      overlay.addEventListener("click", (e) => {
        const target = e.target as HTMLElement;
        // Close if clicking the wrapper or the backdrop (role=dialog)
        // NOT if clicking the card or its children
        if (target === overlay || target.getAttribute("role") === "dialog") {
           closeSpotlight();
        }
      });
    }

    cards.forEach((card) => {
      // 1. HOVER: Pause & Focus (Standard Behavior)
      card.addEventListener("mouseenter", () => {
        // If spotlight is active, ignore hover interactions
        if (section && section.classList.contains("spotlight-active")) return;

        marquees.forEach(m => m.classList.add("marquee-paused"));
        
        cards.forEach((item) => {
          if (item === card) {
            item.classList.add("is-focused");
            item.classList.remove("is-dimmed");
          } else {
            item.classList.add("is-dimmed");
            item.classList.remove("is-focused");
          }
        });
      });

      // 2. LEAVE: Resume (Reset)
      card.addEventListener("mouseleave", () => {
        // If spotlight is active, do NOT resume/reset
        if (section && section.classList.contains("spotlight-active")) return;

        marquees.forEach(m => m.classList.remove("marquee-paused"));
        cards.forEach(item => item.classList.remove("is-focused", "is-dimmed"));
      });

      // 3. CLICK: Open Spotlight
      card.addEventListener("click", (e) => {
        e.stopPropagation(); // Prevent bubbling if needed

        // Gather Data
        const img = card.querySelector("img");
        const name = card.querySelector(".brand-card-title");
        const tagline = card.querySelector(".brand-card-tagline");
        const color = (card as HTMLElement).style.getPropertyValue("--brand-color");

        if (img && name && tagline && section && overlay && spotlightCard && spotlightImg && spotlightName && spotlightTagline) {
           // Populate
           spotlightImg.src = img.src;
           spotlightImg.alt = img.alt;
           spotlightName.textContent = name.textContent;
           spotlightTagline.textContent = tagline.textContent;
           (spotlightCard as HTMLElement).style.setProperty("--brand-color", color);

           // Show Overlay
           section.classList.add("spotlight-active");
           
           // Ensure maruqees stay paused
           marquees.forEach(m => m.classList.add("marquee-paused"));
        }
      });
    });
  });
</script>
