---
import "../../styles/hero.css";
---

<div
  id="hero"
  class="relative w-full h-screen overflow-hidden flex flex-col items-center justify-center bg-[#040406] hero-section transition-colors duration-700"
>
  <div
    class="absolute inset-0 z-0 opacity-70 [background-size:40px_40px] [background-image:linear-gradient(to_right,#1f1f1f_1px,transparent_1px),linear-gradient(to_bottom,#1f1f1f_1px,transparent_1px)] hero-grid transition-opacity duration-700"
    data-parallax
    data-speed="0.05"
  >
  </div>
  <div
    id="heroInteractiveGrid"
    class="absolute inset-0 z-[5] opacity-70"
    aria-hidden="true"
    data-parallax
    data-speed="0.08"
  >
  </div>
  <div
    class="pointer-events-none absolute inset-x-0 bottom-0 top-1/2 z-10 bg-gradient-to-t from-[#040406] via-[#040406]/80 to-transparent hero-gradient-bottom transition-colors duration-700"
  >
  </div>
  <div
    class="pointer-events-none absolute inset-0 z-20 bg-[#040406]/60 [mask-image:radial-gradient(circle_at_center,transparent_0%,black_100%)] hero-vignette transition-colors duration-700"
  >
  </div>

  <div
    class="absolute top-[-20%] left-[-10%] w-[50vw] h-[50vw] bg-[#25c4ff]/10 rounded-full blur-[120px] pointer-events-none mix-blend-screen animate-pulse-slow"
  >
  </div>
  <div
    class="absolute bottom-[-20%] right-[-10%] w-[50vw] h-[50vw] bg-[#ffcc33]/5 rounded-full blur-[120px] pointer-events-none mix-blend-screen animate-pulse-slow delay-1000"
  >
  </div>

  <div
    class="absolute top-[18%] left-[5%] block pointer-events-none opacity-40 font-mono text-[10px] leading-relaxed text-[#25c4ff]"
  >
    <div
      class="typing-code"
      data-code={`const system = {
  status: "OPTIMIZED",
  latam_node: true,
  security: "MAX"
};`}
    >
    </div>
  </div>

  <div
    class="absolute bottom-[25%] right-[5%] flex pointer-events-none opacity-40 font-mono text-[10px] leading-relaxed text-[#ffcc33] text-right"
  >
    <div
      class="typing-code"
      data-code={`await Fantasma.init({
  mode: "SCALABLE",
  modules: ["AI", "UX"]
});`}
    >
    </div>
  </div>

  <div
    class="absolute top-[25%] right-[10%] flex pointer-events-none opacity-30 font-mono text-[10px] leading-relaxed text-white/50"
  >
    <div
      class="typing-code"
      data-code={`import { Future } 
  from "@fantasma/core";`}
    >
    </div>
  </div>

  <div
    class="relative z-30 w-[90%] flex flex-col justify-between items-center gap-10"
  >
    <div
      class="w-full md:w-[75%] xl:w-[55%] flex flex-col items-center text-center gap-5"
    >
      <h1
        class="font-bold text-center flex justify-center reveal-fade-up hero-title transition-colors duration-700 leading-tight"
      >
        <span
          id="heroTitleDesktop"
          class="hidden xl:block text-[6vw] bg-clip-text text-transparent bg-gradient-to-b from-white via-white to-white/50 drop-shadow-sm min-h-[1.2em]"
        ></span>

        <div class="flex flex-col xl:hidden items-center justify-center">
          <span
            id="heroTitleMobile1"
            class="bg-clip-text text-transparent text-[14vw] lg:text-[10vw] leading-tight bg-gradient-to-b from-white via-white to-white/50 drop-shadow-sm min-h-[1.2em]"
          ></span>
          <span
            id="heroTitleMobile2"
            class="bg-clip-text text-transparent text-[14vw] lg:text-[10vw] leading-tight bg-gradient-to-b from-white via-white to-white/50 drop-shadow-sm min-h-[1.2em]"
          ></span>
        </div>
      </h1>

      <p
        class="text-white reveal-fade-up delay-200 hero-description transition-colors duration-700 text-[1.2rem] xl:text-[1.5rem] max-w-2xl"
      >
        Desarrollamos soluciones de software AI-native, diseño UX/UI y
        transformación digital de alto impacto en El Salvador y Centroamérica.
      </p>

      <a
        href="#contact"
        class="relative inline-flex h-12 overflow-hidden rounded-full p-[1px] focus:outline-none mt-8 reveal-fade-up delay-400 hero-cta group"
      >
        <span
          class="absolute inset-[-1000%] animate-[spin_2s_linear_infinite] bg-[conic-gradient(from_90deg_at_50%_50%,#25c4ff_0%,#040406_50%,#ffcc33_100%)]"
        ></span>
        <span
          class="inline-flex h-full w-full cursor-pointer items-center justify-center rounded-full bg-[#040406] px-10 py-1 text-xs font-bold uppercase tracking-widest text-white backdrop-blur-3xl transition-colors duration-300 group-hover:bg-[#040406]/80 hero-cta-inner gap-3"
        >
          Iniciar Proyecto
          <i
            class="fa-solid fa-arrow-right transform -rotate-45 group-hover:rotate-0 transition-transform duration-300 text-[#ffcc33]"
          ></i>
        </span>
      </a>
    </div>
  </div>
</div>

<style>
  /* Styles unchanged from previous request, kept for consistency */
  :global(body.theme-light) .hero-section {
    background-color: #ffffff !important;
  }
  :global(body.theme-light) .hero-grid {
    background-image:
      linear-gradient(to right, #e5e5e5 1px, transparent 1px),
      linear-gradient(to bottom, #e5e5e5 1px, transparent 1px) !important;
  }
  :global(body.theme-light) .hero-gradient-bottom {
    background: linear-gradient(
      to top,
      #ffffff,
      rgba(255, 255, 255, 0.8),
      transparent
    ) !important;
  }
  :global(body.theme-light) .hero-vignette {
    background-color: rgba(255, 255, 255, 0.6) !important;
    mask-image: radial-gradient(
      circle at center,
      transparent 10%,
      black 85%
    ) !important;
  }
  :global(body.theme-light) .hero-title {
    color: #040406 !important;
  }
  :global(body.theme-light) .hero-description {
    color: #333333 !important;
  }
  :global(body.theme-light) .hero-cta {
    border: none !important;
    background: transparent !important;
  }
  :global(body.theme-light) .hero-cta-inner {
    background-color: #ffffff !important;
    color: #040406 !important;
  }
  :global(body.theme-light) .hero-cta-inner:hover {
    background-color: #f0f0f0 !important;
  }
  :global(body.theme-light) .hero-cta:hover {
    background-color: rgba(4, 4, 6, 0.1) !important;
  }

  @keyframes pulse-slow {
    0%,
    100% {
      opacity: 0.5;
      transform: scale(1);
    }
    50% {
      opacity: 0.8;
      transform: scale(1.1);
    }
  }

  /* Cursor Effect */
  .typing-cursor::after {
    content: "|";
    animation: blink 1s step-end infinite;
    margin-left: 2px;
    opacity: 0.7;
    color: currentColor;
  }
  @keyframes blink {
    50% {
      opacity: 0;
    }
  }
  .typing-code {
    white-space: pre;
  }
</style>

<script>
  if (history.scrollRestoration) {
    history.scrollRestoration = "manual";
  }
  window.scrollTo(0, 0);

  document.addEventListener("DOMContentLoaded", () => {
    // --- CONFIGURACIÓN ---
    const SCROLL_THRESHOLD = 50;
    const SLOW_SPEED = 100;
    const FAST_SPEED = 40;
    const LG_BREAKPOINT = 1280; // Transition at XL breakpoint to match Tailwind xl:block/hidden

    // Selectores
    const desktopTitle = document.getElementById("heroTitleDesktop");
    const mobileTitle1 = document.getElementById("heroTitleMobile1");
    const mobileTitle2 = document.getElementById("heroTitleMobile2");

    // Textos
    const TEXT_DESKTOP = "Innovación Escalable.";
    const TEXT_MOBILE_1 = "Innovación";
    const TEXT_MOBILE_2 = "Escalable.";

    // Estado
    let isRevealed = false;
    let initialAnimationDone = false;
    let animationTimeouts: any[] = [];
    let isCurrentlyLarge = window.innerWidth >= LG_BREAKPOINT;

    // --- UTILIDADES ---

    function isLargeScreen() {
      return window.innerWidth >= LG_BREAKPOINT;
    }

    function stopAllAnimations() {
      animationTimeouts.forEach((t) => clearTimeout(t));
      animationTimeouts = [];
    }

    // Función Core de Tipeo (Recursiva)
    function typeEffect(
      element: HTMLElement | null,
      text: string,
      speed: number,
      isReverse: boolean,
      callback?: () => void
    ) {
      if (!element) return;

      let currentText = element.textContent || "";
      const step = () => {
        if (!isReverse) {
          // ESCRIBIENDO
          if (currentText.length < text.length) {
            currentText += text[currentText.length];
            element.textContent = currentText;
            animationTimeouts.push(setTimeout(step, speed));
          } else {
            if (callback) callback();
          }
        } else {
          // BORRANDO
          if (currentText.length > 0) {
            currentText = currentText.substring(0, currentText.length - 1);
            element.textContent = currentText;
            animationTimeouts.push(setTimeout(step, speed));
          } else {
            if (callback) callback();
          }
        }
      };
      step();
    }

    // --- CONTROLADOR DE ANIMACIONES ---

    function runAnimation(isReverse: boolean) {
      stopAllAnimations();
      const speed = isReverse ? FAST_SPEED : SLOW_SPEED;

      if (isLargeScreen()) {
        // === LÓGICA DESKTOP (1 Línea) ===
        // Limpiamos rastros móviles por seguridad
        if (mobileTitle1) mobileTitle1.textContent = "";
        if (mobileTitle2) mobileTitle2.textContent = "";

        typeEffect(desktopTitle, TEXT_DESKTOP, speed, isReverse, () => {
          isRevealed = !isReverse;
          initialAnimationDone = true;
        });
      } else {
        // === LÓGICA MÓVIL (2 Líneas Secuenciales) ===
        // Limpiamos rastros desktop
        if (desktopTitle) desktopTitle.textContent = "";

        if (mobileTitle1 && mobileTitle2) {
          if (!isReverse) {
            // Escribir: Linea 1 -> Linea 2
            typeEffect(mobileTitle1, TEXT_MOBILE_1, speed, false, () => {
              typeEffect(mobileTitle2, TEXT_MOBILE_2, speed, false, () => {
                isRevealed = true;
                initialAnimationDone = true;
              });
            });
          } else {
            // Borrar: Linea 2 -> Linea 1 (Inverso para que se vea mejor)
            typeEffect(mobileTitle2, "", speed, true, () => {
              typeEffect(mobileTitle1, "", speed, true, () => {
                isRevealed = false;
                initialAnimationDone = true;
              });
            });
          }
        }
      }
    }

    // --- HANDLERS ---

    function handleScroll() {
      const scroll = window.scrollY;

      // 1. Borrar al bajar
      if (scroll > SCROLL_THRESHOLD && isRevealed && initialAnimationDone) {
        runAnimation(true);
      }
      // 2. Escribir al subir
      else if (
        scroll <= SCROLL_THRESHOLD &&
        !isRevealed &&
        initialAnimationDone
      ) {
        runAnimation(false);
      }
    }

    function handleResize() {
      const nowLarge = isLargeScreen();
      // Solo reiniciamos si cruzamos el umbral (Mobile <-> Desktop)
      if (nowLarge !== isCurrentlyLarge) {
        isCurrentlyLarge = nowLarge;
        stopAllAnimations();

        // Limpiamos todo visualmente
        if (desktopTitle) desktopTitle.textContent = "";
        if (mobileTitle1) mobileTitle1.textContent = "";
        if (mobileTitle2) mobileTitle2.textContent = "";

        isRevealed = false;
        initialAnimationDone = false;

        // Reiniciar animación desde cero en el nuevo modo
        runAnimation(false);
      }
    }

    // --- INICIALIZACIÓN ---

    // Arrancamos la primera animación
    runAnimation(false);

    // Event Listeners
    window.addEventListener("scroll", handleScroll);
    window.addEventListener("resize", handleResize);

    // --- SNIPPETS DE CÓDIGO (Solo visuales) ---
    // Esta lógica es puramente decorativa y no afecta al título
    const codeSnippets = document.querySelectorAll(".typing-code");
    codeSnippets.forEach((el, index) => {
      const text = el.getAttribute("data-code") || "";
      const delay = index * 1500 + 500;

      setTimeout(() => {
        let i = 0;
        el.innerHTML = '<span class="typing-cursor"></span>';
        const cursor: any = el.querySelector(".typing-cursor");

        function typeChar() {
          if (i < text.length) {
            const char = text.charAt(i);
            cursor.insertAdjacentText("beforebegin", char);
            i++;
            setTimeout(typeChar, Math.random() * 50 + 30);
          }
        }
        typeChar();
      }, delay);
    });
  });
</script>
